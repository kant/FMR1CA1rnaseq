---
title: "Behavior Data Analysis"
author: "Rayna M Harris"
date: "Last updated November 22, 2017"
output: md_document
---


```{r setup, echo = F, message=F}
## load libraries 
library(tidyr) ## for respahing data
library(plyr) ## for renmaing factors
library(dplyr) ## for filtering and selecting rows
library(reshape2) ## for melting dataframe
library(ggplot2)
library(cowplot)
library(pheatmap)
library(viridis)
library(car) # for fancy ANOVA

## load color settings
source("figureoptions.R")

knitr::opts_chunk$set(fig.path = '../figures/01_behavior/')
```

# Experimental design

![Active place avoidance task with conflict training.](../figures/fig1-01.png)

##### Mice were assigned to one of four groups: consistently-trained (red), yoked-consistent (dark grey), conflict-trained (peach), or yoked-conflict (light grey). Mice were placed on the rotating arena (1 rpm) for training sessions that lasted 10 min and was separated by 2-h intersession interval or overnight (~17 h). The physical conditions are identical for all mice during pre-training and retention. Sample sizes for each treatment group and genotype are shown on the bottom right.


```{r samplesize, echo = F, message=F, warning = F}
## read intermediate data (raw data from video tracker program analyzed in matlab)
behavior <- read.csv("../data/fmr1.csv", header = T)
behavior$APA <- as.factor(behavior$APA)
behavior$APA2 <- as.factor(behavior$APA2)

## relevel then rename factors treatment
behavior$APA2 <- factor(behavior$APA2, levels = c("controlconsistent", "consistent", "controlconflict", "conflict"))
levels(behavior$APA2) <- c("yoked-consistent","consistent", "yoked-conflict","conflict")
levels(behavior$APA2)

#relevel genotype
levels(behavior$Genotype) <- c("WT","FMR1KO")
#levels(behavior$conflict) <- c("consistent","conflict")

behavior$Time1stEntrLog <- log(behavior$Time1stEntr)  ## log transformation
behavior$conflict <- ifelse(grepl("conflict", behavior$APA2), "conflict", "consistent") # for splitting
levels(behavior$conflict) <- c("consistent","conflict")
behavior <- behavior[c(1,3,7,8,10,60,14:59)] # supset data
behavior <- subset(behavior, !is.na(behavior$NumEntrances)) # remove nas

# sample sizes
behavior %>% 
  filter(TrainSessionCombo == "Retention", Genotype == "WT") %>%
  select(APA2, Genotype)  %>%  summary()
behavior %>% 
  filter(TrainSessionCombo == "Retention", Genotype == "FMR1KO") %>%
  select(APA2, Genotype)  %>%  summary()


## proptime
proptime <- behavior[,c(1,2,4,8,9,12,26:29)]
proptime <- melt(proptime, id.vars = c("ID", "Genotype", "TrainSession",
                                       "APA2", "TrainSessionCombo","TrainSessionComboNum")) 

```


![Figure 2: No group differences prior to behavioral manipulation.](../figures/fig1-04.png)




```{r, warning = F}
## pretraining

PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "1") 
summary(aov(pTimeTarget ~  APA2 + Genotype, data=PathNumStats))
summary(aov(pTimeOPP ~  APA2 + Genotype, data=PathNumStats))
summary(aov(pTimeCW ~  APA2 + Genotype, data=PathNumStats))
summary(aov(pTimeCCW ~  APA2 + Genotype, data=PathNumStats))

Anova(lm(data = PathNumStats, pTimeTarget ~ Genotype * APA2 ), type = 3)

mean(PathNumStats$pTimeTarget)
mean(PathNumStats$pTimeOPP)
mean(PathNumStats$pTimeCW)
mean(PathNumStats$pTimeCCW)

summary(aov(NumEntrances ~  APA2 * Genotype, data=PathNumStats))
summary(aov(Path1stEntr~  APA2 * Genotype, data=PathNumStats))
mean(PathNumStats$NumEntrances)
mean(PathNumStats$Path1stEntr)

summary(aov(value ~  APA2 * Genotype + variable, data=proptime))

## conflict
PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "6") 
Anova(lm(data = PathNumStats, NumEntrances ~ Genotype * APA2 ), type = 3)
summary(aov(NumEntrances ~  APA2 * Genotype, data=PathNumStats))
TukeyHSD(aov(NumEntrances~  APA2 * Genotype, data=PathNumStats))
mean(PathNumStats$NumEntrances)

PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "6",
         APA2 %in% c("yoked-consistent", "yoked-conflict")) 
mean(PathNumStats$NumEntrances)
PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "6",
         APA2 %in% c("consistent", "conflict")) 
mean(PathNumStats$NumEntrances)


PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "7") 
Anova(lm(data = PathNumStats, Path1stEntr ~ Genotype * APA2 ), type = 3)
summary(aov(Path1stEntr~  APA2 * Genotype, data=PathNumStats))
TukeyHSD(aov(Path1stEntr~  APA2 * Genotype, data=PathNumStats))
mean(PathNumStats$Path1stEntr)

PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "7",
         Genotype == "WT")
Anova(lm(data = PathNumStats, Path1stEntr ~  APA2 ), type = 3)
summary(aov(Path1stEntr~  APA2, data=PathNumStats))
TukeyHSD(aov(Path1stEntr~  APA2, data=PathNumStats))

PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "7",
         Genotype != "WT")
Anova(lm(data = PathNumStats, Path1stEntr ~  APA2 ), type = 3)
summary(aov(Path1stEntr~  APA2, data=PathNumStats))
TukeyHSD(aov(Path1stEntr~  APA2, data=PathNumStats))



```

 
```{r figure2, echo = F }
 
num1 <- behavior %>%
    filter(TrainSessionComboNum %in% c("1")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = NumEntrances, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
    background_grid(major = "y", minor = "none") +
   scale_y_continuous(name = "Pre-training number of entrances",
                     limits = c(0,35)) +
  geom_hline(yintercept=c(28.58), color="black", linetype = "dashed" ) + 
  theme_cowplot(font_size = 8, line_size = 0.25) + 
  theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 

path1 <- behavior %>%
    filter(TrainSessionComboNum %in% c("1")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = Path1stEntr, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
   scale_y_continuous(name = "Pre-training path to 1st entrance") +
    geom_hline(yintercept=c(0.42), color="black" , linetype = "dashed") + 
  theme_cowplot(font_size = 8, line_size = 0.25) + 
  theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 

legend2 <- behavior %>%
    filter(TrainSessionComboNum %in% c("1")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = NumEntrances, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) + 
    scale_y_continuous(name = "Number of entrances") +
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
  #geom_hline(yintercept=c(0.32), color="black" , linetype="dashed") + 
  theme_cowplot(font_size = 7, line_size = 0.25) +
  theme(legend.position = "bottom")

pdf(file="../figures/01_behavior/num1.pdf", width=1.75, height=1.9)
plot(num1)
dev.off()
pdf(file="../figures/01_behavior/path1.pdf", width=1.75, height=1.9)
plot(path1)
dev.off()
pdf(file="../figures/01_behavior/legend2.pdf", width=4, height=2)
plot(legend2)
dev.off()

conflict6 <- behavior %>%
    filter(TrainSessionComboNum %in% c("6")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = NumEntrances, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(6),
                       labels = c("C1")) +
   scale_y_continuous(name = "C1 number of entrances",
                      limits = c(0,24)) +
    #geom_hline(yintercept=c(16.6875), color="black", linetype = "dashed" ) + 
    #  geom_hline(yintercept=c(8.75), color="red", linetype = "dashed" ) + 
  theme_cowplot(font_size = 8, line_size = 0.25) + 
  theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 


conflict7 <- behavior %>%
    filter(TrainSessionComboNum %in% c("7")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = Path1stEntr, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(7),
                       labels = c("C2")) +
   scale_y_continuous(name = "C2 path to 1st entrance") +
    geom_hline(yintercept=c(2.859524), color="black" , linetype = "dashed") + 
  theme_cowplot(font_size = 8, line_size = 0.25) + 
  theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 

pdf(file="../figures/01_behavior/conflict6.pdf", width=1.75, height=1.9)
plot(conflict6)
dev.off()
pdf(file="../figures/01_behavior/conflict7.pdf", width=1.75, height=1.9)
plot(conflict7)
dev.off()
```


![](../figures/fig1-06.png)


![Figure 2.4](../figures/fig1-07.png)


```{r}
timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("2", "3", "4", "5" ,"6", "7", "8")) 
Anova(lm(data = timespent, pTimeTarget ~ Genotype * APA2 ), type = 3)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("2", "3", "4", "5" ,"6", "7", "8")) %>%
  filter(APA2 %in% c("yoked-consistent", "yoked-conflict"))
Anova(lm(data = timespent, pTimeTarget ~ Genotype * APA2 ), type = 3)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("2", "3", "4")) %>%
  filter(APA2 %in% c("consistent", "conflict"))
summary(aov(data =  timespent, pTimeTarget ~ Genotype * APA2 ))
Anova(lm(data = timespent, pTimeTarget ~ Genotype * APA2 ), type = 3)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>%
  filter(APA2 %in% c("consistent", "conflict"))
Anova(lm(data = timespent, pTimeTarget ~ Genotype * APA2 ), type = 3)
Anova(lm(data = timespent, pTimeCW ~ Genotype * APA2 ), type = 3)
Anova(lm(data = timespent, pTimeCCW ~ Genotype * APA2 ), type = 3)
Anova(lm(data = timespent, pTimeOPP ~ Genotype * APA2 ), type = 3)

TukeyHSD(aov(data = timespent, pTimeTarget ~ Genotype * APA2 ))
TukeyHSD(aov(data = timespent, pTimeCW ~ Genotype * APA2 ))
TukeyHSD(aov(data = timespent, pTimeCCW ~ Genotype * APA2 ))
TukeyHSD(aov(data = timespent, pTimeOPP ~ Genotype * APA2 ))


mean(timespent$pTimeTarget)
mean(timespent$pTimeOPP)
mean(timespent$pTimeCW)
mean(timespent$pTimeCCW)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>%
  filter(APA2 %in% c("conflict"))

mean(timespent$pTimeTarget)
mean(timespent$pTimeOPP)
mean(timespent$pTimeCW)
mean(timespent$pTimeCCW)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>%
  filter(APA2 %in% c("consistent"))

mean(timespent$pTimeTarget)
mean(timespent$pTimeOPP)
mean(timespent$pTimeCW)
mean(timespent$pTimeCCW)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>%
  filter(Genotype %in% c("FMR1KO"))
mean(timespent$pTimeOPP)

timespent <- behavior %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>%
  filter(Genotype %in% c("WT"))
mean(timespent$pTimeOPP)

```


```{r timespent, echo=F, warning=F, results=F}
PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum != "1", TrainSessionComboNum != "9") 
summary(aov(pTimeTarget ~  APA2 * Genotype, data=PathNumStats))
summary(aov(pTimeOPP ~  APA2 * Genotype, data=PathNumStats))
summary(aov(pTimeTarget ~  APA2 * Genotype, data=PathNumStats))
summary(aov(pTimeCCW ~  APA2 * Genotype, data=PathNumStats))

timespent1 <- proptime %>%
  filter(APA2 %in% c("consistent","conflict")) %>%
  filter(TrainSessionComboNum != 1, TrainSessionComboNum != 9 ) %>%
  ggplot(aes(x = TrainSessionComboNum, y = value,fill = variable)) + 
    geom_bar(position = "fill",stat = "identity") +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "P", "T1", "T2", "T3",
                                   "Rt", "C1", "C2","C3", 
                                   "Rn")) +
  facet_wrap(~APA2*Genotype, nrow=1) +
  theme_cowplot(font_size = 8, line_size = 0.25) +  theme(legend.title=element_blank()) +
    theme(legend.position="none") +
  scale_y_continuous(name= "Proportion of Time Spent",
                     breaks = c(0.32,0.64, 0.96)) +
  scale_fill_manual(values = c("#d01c8b", "#e5f5e0" ,"#a1d99b", "#31a354")) + 
  geom_hline(yintercept=c(0.32,0.64, 0.96), color="black" , linetype="dashed") 


timespent2 <- proptime %>%
  filter(APA2 %in% c("yoked-consistent","yoked-conflict")) %>%
    filter(TrainSessionComboNum != 1, TrainSessionComboNum != 9 ) %>%
  ggplot(aes(x = TrainSessionComboNum, y = value,fill = variable)) + 
    geom_bar(position = "fill",stat = "identity") +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "P", "T1", "T2", "T3",
                                   "Rt", "C1", "C2","C3", 
                                   "Rn")) +
  facet_wrap(~APA2*Genotype, nrow=1) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_y_continuous(name= "Proportion of Time Spent") +
  scale_fill_manual(values = c("#d01c8b", "#e5f5e0" ,"#a1d99b", "#31a354")) + 
  geom_hline(yintercept=c(0.25,0.50, 0.75), color="black" , linetype="dashed")


pdf(file="../figures/01_behavior/timespent1.pdf", width=6, height=2.25)
plot(timespent1)
dev.off()

pdf(file="../figures/01_behavior/timespent2.pdf", width=6, height=2.25)
plot(timespent2)
dev.off()


timespent3 <- proptime %>%
  filter(TrainSessionComboNum %in% c("1")) %>%
  ggplot(aes(x = APA2, y = value,fill = variable)) + 
    geom_bar(position = "fill",stat = "identity") +
    scale_x_discrete(name=NULL,
                     labels = c("yoked", "consistent", "yoked", "conflict")) +
  facet_wrap(~Genotype, nrow=1) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_y_continuous(name= "Pre-training proportion of time spent") +
  scale_fill_manual(values = c("#f1b6da", "#e5f5e0" ,"#a1d99b", "#31a354")) + 
  geom_hline(yintercept=c(0.25,0.50, 0.75), color="black" , linetype="dashed") +
  theme(strip.text.x = element_text(size = 8)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



pdf(file="../figures/01_behavior/timespent3.pdf", width=2, height=2.25)
plot(timespent3)
dev.off()

timespent4 <- proptime %>%
  #filter(APA2 %in% c("yoked-consistent","yoked-conflict")) %>%
  filter(TrainSessionComboNum %in% c("9")) %>%
  ggplot(aes(x = APA2, y = value,fill = variable)) + 
    geom_bar(position = "fill",stat = "identity") +
    scale_x_discrete(name=NULL,
                     labels = c("yoked", "consistent", "yoked", "conflict")) +
  facet_wrap(~Genotype, nrow=1) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_y_continuous(name= "Proportion of Time Spent") +
  scale_fill_manual(values = c("#f1b6da", "#e5f5e0" ,"#a1d99b", "#31a354")) + 
   # geom_hline(yintercept=c(0.25,0.50, 0.75), color="black" , linetype="dashed") +
  theme(strip.text.x = element_text(size = 8)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

pdf(file="../figures/01_behavior/timespent4.pdf", width=2, height=2.25)
plot(timespent4)
dev.off()

timeccw <- behavior %>%
  filter(APA2 %in% c("consistent","conflict")) %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = pTimeCCW, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = c("#ca0020", "#f4a582")) +  
 scale_x_continuous(name="Counter clockwise", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
  geom_hline(yintercept=c(0.32), color="black" , linetype="dashed") + 
    scale_y_continuous(name = " ",
      breaks = c(0,0.32, 0.64),
                     limits= c(0,0.8)) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  theme(legend.position="none")

timecw <- behavior %>%
  filter(APA2 %in% c("consistent","conflict")) %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = pTimeCW, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = c("#ca0020", "#f4a582")) +  
 scale_x_continuous(name="Clockwise", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
  geom_hline(yintercept=c(0.32), color="black" , linetype="dashed") + 
    scale_y_continuous(name = NULL,
                       breaks = c(0,0.32, 0.64),
                     limits= c(0,0.8)) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
 theme(legend.position="none")

timet <- behavior %>%
  filter(APA2 %in% c("consistent","conflict")) %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = pTimeTarget, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = c("#ca0020", "#f4a582")) +  
 scale_x_continuous(name="Shock Zone", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
    scale_y_continuous(name = "Propotion of Time Spent",
                       breaks = c(0,0.04, 0.08, 0.12),
                         limits= c(0,0.14)) +
  #geom_hline(yintercept=c(0.04), color="black" , linetype="dashed") + 
  theme_cowplot(font_size = 8, line_size = 0.25) +
 theme(legend.position="none")


timeopp <- behavior %>%
  filter(APA2 %in% c("consistent","conflict")) %>%
    filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = pTimeOPP, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = c("#ca0020", "#f4a582")) + 
    scale_y_continuous(name = " ",
                       breaks = c(0,0.32, 0.64),
                     limits= c(0,0.8)) +
 scale_x_continuous(name="Opposite", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
  geom_hline(yintercept=c(0.32), color="black" , linetype="dashed") + 
  theme_cowplot(font_size = 8, line_size = 0.25) +
  theme(legend.position="none")


numentr1 <- behavior %>%
    filter(TrainSessionComboNum %in% c("1")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = NumEntrances, fill=APA2)) +
  geom_boxplot(outlier.size=0.8) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) + 
    scale_y_continuous(name = "Number of entrances") +
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
  #geom_hline(yintercept=c(0.32), color="black" , linetype="dashed") + 
  theme_cowplot(font_size = 8, line_size = 0.25) +
 theme(legend.position="none")


pdf(file="../figures/01_behavior/timecw.pdf", width=1.5, height=2)
plot(timecw)
dev.off()
pdf(file="../figures/01_behavior/timeccw.pdf", width=1.5, height=2)
plot(timeccw)
dev.off()

pdf(file="../figures/01_behavior/timet.pdf", width=1.5, height=2)
plot(timet)
dev.off()
pdf(file="../figures/01_behavior/timeopp.pdf", width=1.5, height=2)
plot(timeopp)
dev.off()

```


![Fig. 2.5.Summary of punishment and estimates of memory in WT and FMR1-KO mice](../figures/fig1-02.png)



```{r, echo =F, warning = F, results = F}
# behaviors
numentr <- dplyr::summarise(group_by(behavior, Genotype, APA2, TrainSessionComboNum, conflict), m = mean(NumEntrances), se = sd(NumEntrances)/sqrt(length(NumEntrances)), len = length(NumEntrances))

pathentr <- dplyr::summarise(group_by(behavior, Genotype, APA2, TrainSessionComboNum, conflict), m = mean(Path1stEntr), se = sd(Path1stEntr)/sqrt(length(Path1stEntr)), len = length(Path1stEntr))

levels(numentr$APA2) <- c("yoked-consistent","consistent", "yoked-conflict","conflict")
levels(pathentr$APA2) <- c("yoked-consistent","consistent", "yoked-conflict","conflict")

numentr$conflict = factor(numentr$conflict, levels = c("consistent","conflict"))
pathentr$conflict = factor(numentr$conflict, levels = c("consistent","conflict"))
numentr$measure <- "Number of Entrances"
pathentr$measure <- "Path to the 1st Entrance"

PathNum <- rbind(pathentr,numentr)
PathNum$measure <- as.factor(PathNum$measure)
write.csv(PathNum, "../data/01_behaviordatasummary.csv")

numenrwt <- PathNum  %>% 
  #filter(TrainSessionComboNum != "1", TrainSessionComboNum != "9") %>% 
  filter(measure == "Number of Entrances") %>% 
  filter(Genotype == "WT") %>% 
  droplevels()  %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(aes(colour=APA2, linetype=Genotype)) +
   scale_y_continuous(name= "Number of Entrances",
                      limits = c(0,35)) +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2" ,"C3", 
                                   "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor="non") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(16, 1)) 


pdf(file="../figures/01_behavior/numenrwt.pdf", width=2.25, height=2)
plot(numenrwt)
dev.off()

numenrfmr1 <- PathNum  %>% 
  filter(TrainSessionComboNum != "1", TrainSessionComboNum != "9") %>% 
  filter(measure == "Number of Entrances") %>% 
  filter(Genotype != "WT") %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(linetype = 2, aes(colour=APA2)) +
   scale_y_continuous(name= "Number of Entrances",
                      limits = c(0,35)) +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2","C3", 
                                  "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor = "none") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(1)) 



pdf(file="../figures/01_behavior/numenrfmr1.pdf", width=2.25, height=2)
plot(numenrfmr1)
dev.off()


pathfmr1 <- PathNum  %>% 
  filter(measure == "Path to the 1st Entrance") %>% 
  filter(Genotype != "WT") %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(linetype = 2, aes(colour=APA2)) +
   scale_y_continuous(name= "Path to the 1st Entrance",
                      limits = c(0,17.5)) +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2", "C3", 
                                    "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor = "none") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(1)) 


pdf(file="../figures/01_behavior/pathfmr1.pdf", width=2.25, height=2)
plot(pathfmr1)
dev.off()

pathwt <- PathNum  %>% 
  #filter(TrainSessionComboNum != "1", TrainSessionComboNum != "9") %>% 
  filter(measure == "Path to the 1st Entrance") %>% 
  filter(Genotype == "WT") %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(linetype = 1, aes(colour=APA2)) +
   scale_y_continuous(name= "Path to the 1st Entrance",
                      limits = c(0,17.5)) +
    scale_x_continuous(name="Training Session", 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2","C3", 
                                   "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor = "none") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(16)) 


pdf(file="../figures/01_behavior/pathwt.pdf", width=2.25, height=2)
plot(pathwt)
dev.off()


conflictnum <- PathNum  %>% 
  filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  filter(measure == "Number of Entrances") %>% 
  #filter(Genotype == "WT") %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(aes(linetype=Genotype, colour=APA2)) +
   scale_y_continuous(name= "Conflict number of entrances") +
    scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2","C3", 
                                   "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor = "none") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(16,1)) 

pdf(file="../figures/01_behavior/conflictnum.pdf", width=1.5, height=2)
plot(conflictnum)
dev.off()

conflictpath <- PathNum  %>% 
  filter(TrainSessionComboNum %in% c("6", "7", "8")) %>% 
  filter(measure == "Path to the 1st Entrance") %>% 
  #filter(Genotype == "WT") %>% 
  ggplot(aes(x=, TrainSessionComboNum, y=m, color=APA2, shape=Genotype)) + 
    geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
    geom_point(size = 2) +
   geom_line(aes(linetype=Genotype, colour=APA2)) +
   scale_y_continuous(name= "Conflict path to 1st entrance") +
    scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = c( "Pre.", "T1", "T2", "T3",
                                   "Retest", "C1", "C2","C3", 
                                   "Reten.")) +
  theme_cowplot(font_size = 8, line_size = 0.25) +
  background_grid(major = "y", minor = "none") +
  scale_color_manual(values = colorvalAPA00)  +
  theme(legend.title=element_blank()) +
  theme(legend.position="none") +
  scale_shape_manual(values=c(16,1)) 

pdf(file="../figures/01_behavior/conflictpath.pdf", width=1.5, height=2)
plot(conflictpath)
dev.off()


```



![Fig. 2.6.Retention mice](../figures/fig1-09.png)


```{r retention}
PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum == "9") 

summary(aov(NumEntrances ~  APA2 * Genotype, data=PathNumStats))
summary(aov(Path1stEntr ~  APA2 * Genotype, data=PathNumStats))

Anova(lm(data = PathNumStats, Path1stEntr ~ APA2 * Genotype), type = 3)
Anova(lm(data = PathNumStats, NumEntrances ~ APA2 * Genotype ), type = 3)
Anova(lm(data = PathNumStats, pTimeTarget ~ APA2 * Genotype ), type = 3)

TukeyHSD(aov(data = PathNumStats, NumEntrances ~ Genotype * APA2))
TukeyHSD(aov(data = PathNumStats, Path1stEntr ~ Genotype * APA2))
TukeyHSD(aov(data = PathNumStats, pTimeTarget ~  Genotype * APA2))


PathNumStats <- behavior  %>% 
 filter(TrainSessionComboNum %in% c("9"))  %>% 
  filter(APA2 %in% c("yoked-consistent", "yoked-conflict")) 
mean(PathNumStats$NumEntrances)
mean(PathNumStats$Path1stEntr)
mean(PathNumStats$pTimeTarget)

PathNumStats <- behavior  %>% 
   filter(TrainSessionComboNum %in% c("9"))  %>%
  filter(APA2 %in% c("consistent", "conflict")) 
mean(PathNumStats$NumEntrances)
mean(PathNumStats$Path1stEntr)
mean(PathNumStats$pTimeTarget)

PathNumStats <- behavior  %>% 
   filter(TrainSessionComboNum %in% c("9"))  
mean(PathNumStats$Path1stEntr)

```

```{r conflict}
PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum  %in% c("7")) 
TukeyHSD(aov(data = PathNumStats, Path1stEntr ~ Genotype * APA2))

PathNumStats <- behavior  %>% 
  filter(TrainSessionComboNum  %in% c("6")) 
TukeyHSD(aov(data = PathNumStats, NumEntrances ~ Genotype * APA2))
```

```{r retention2}
num9 <- behavior %>%
    filter(TrainSessionComboNum %in% c("9")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = NumEntrances, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~Genotype) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
    background_grid(major = "y", minor = "none") +
   scale_y_continuous(name = "Retention number of entrances",
                     limits = c(0,35)) +
  #geom_hline(yintercept=c(9.21), color="red" , linetype = "dashed") + 
   # geom_hline(yintercept=c(18.65), color="black", linetype = "dashed" ) + 
  theme_cowplot(font_size = 8, line_size = 0.25) + 
  theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 

path9 <- behavior %>%
    filter(TrainSessionComboNum %in% c("9")) %>% 
  ggplot(aes(x = as.numeric(TrainSessionComboNum), y = Path1stEntr, fill=APA2)) +
  geom_boxplot(outlier.size=0.8, lwd=0.5) +
  facet_wrap(~ Genotype ) +
  scale_fill_manual(values = colorvalAPA00) +  
 scale_x_continuous(name=NULL, 
                       breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = NULL) +
   scale_y_continuous(name = "Retention path to 1st entrance") +
   geom_hline(yintercept=c(2.832), color="black" , linetype = "dashed") + 
   theme_cowplot(font_size = 8, line_size = 0.25) + 
   theme(legend.position="none") +
    background_grid(major = "y", minor = "none") 


pdf(file="../figures/01_behavior/num9.pdf", width=1.75, height=1.9)
plot(num9)
dev.off()
pdf(file="../figures/01_behavior/path9.pdf", width=1.75, height=1.9)
plot(path9)
dev.off()
```
